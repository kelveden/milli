/*! milli 2013-11-25 */
(function(t){function e(t,e){function n(t){o.respondWith.status=t,this.body=function(t,e){return o.respondWith.body=t,o.respondWith.contentType=e,this},this.header=function(t,e){return o.respondWith.headers=o.respondWith.headers||{},o.respondWith.headers[t]=e,this},this.times=function(t){return o.times=t,this},this._addStubRequestBody=o}var o={criteria:{url:e,method:t},respondWith:{}};this.body=function(t,e){return o.criteria.body=t,o.criteria.contentType=e,this},this.header=function(t,e){return o.criteria.headers=o.criteria.headers||{},o.criteria.headers[t]=e,this},this.respondWith=function(t){return new n(t)}}function n(t,e){s.open("POST","http://localhost:"+r+"/_vanilli/stubs",!0),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?e():400===s.status?e(Error("One or more stubs were invalid. "+s.responseText)):e(Error("Could not add stubs. "+s.responseText)))},s.setRequestHeader("Content-Type","application/json"),s.send(JSON.stringify(t))}function o(t){s.open("DELETE","http://localhost:"+r+"/_vanilli/stubs",!0),s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t():t(Error("Could not clear stubs. "+s.responseText)))},s.send()}var r,s,i=[];t.milli={configure:function(t){if(!t)throw Error("Config must be specified.");if(!t.port)throw Error("config.port must be specified.");r=t.port,s=new XMLHttpRequest},stub:function(t,e){if(!t)throw Error("Stub content must be specified.");return i.push(t),e&&n(i.map(function(t){return t._addStubRequestBody}),function(t){i.length=0,e(t)}),this},expect:function(t,e){return t._addStubRequestBody.times||0===t._addStubRequestBody.times||(t._addStubRequestBody.times=1),this.stub(t,e)},clearStubs:function(t){o(t)}},t.onRequestTo=function(t,n){return new e(t,n)},t.onGetTo=function(e){return t.onRequestTo("GET",e)},t.onDeleteTo=function(e){return t.onRequestTo("DELETE",e)},t.onPutTo=function(e){return t.onRequestTo("PUT",e)},t.onPostTo=function(e){return t.onRequestTo("POST",e)}})(window.exports?window.exports:window);